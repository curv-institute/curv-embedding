# Claude Execution Output — v1.5.0 Hybrid Chunking

**Timestamp:** 2026-01-16T20:31:04Z
**Input Prompt:** `AGENT/1768595075-in.md`
**Git Base:** v1.4.0 (commit ac010d31951b)

---

## v1.4.0 Takeaway (Mandatory Incorporation)

> **Takeaway (v1.4.0):** Stability-driven chunking optimizes representational coherence but increases sensitivity to localized edits due to larger chunk granularity, while fixed-size overlapping chunking provides higher mutation tolerance by limiting invalidation scope. Representational stability and mutation tolerance are distinct, competing objectives.

---

## Summary

Implemented and evaluated hybrid chunking policy that combines stability-driven base chunks with localized overlapping micro-chunks in edit windows. Compared three policies under identical temporal update scenarios.

---

## Key Results

| Metric | Baseline | Stability | Hybrid |
|--------|----------|-----------|--------|
| **Mutation Tolerance** | | | |
| Re-embed Fraction | 60.7% | 63.3% | 69.7% |
| Chunks Unchanged | 72 | 40 | 36 |
| **Neighbor Churn** | | | |
| Top-k Overlap | 0.428 | 0.318 | 0.347 |
| **Structural Overhead** | | | |
| Total Chunks | 92 | 55 | 67 |
| Mean Chunk Size | 1,683 bytes | 2,742 bytes | 711 bytes |
| Micro-chunk Fraction | — | — | 52.2% |
| **Localization** | | | |
| Localization Efficiency | — | — | 80.7% |

---

## Hypothesis Evaluation

**Original Hypothesis:** A hybrid policy combining stability-driven base chunks with localized overlapping chunks in edit regions will:
1. Reduce re-embed fraction relative to pure stability-driven chunking
2. Preserve chunk coherence away from edits
3. Approach or exceed baseline mutation tolerance

**Result:** The hypothesis is **partially supported**.

### What Worked

1. **Improved neighbor stability over pure stability:** Hybrid achieved 0.347 top-k overlap vs stability's 0.318 (+9.1% relative improvement)

2. **High localization efficiency:** 80.7% of re-embeds were confined to edit windows, demonstrating the hybrid policy successfully isolates changes

3. **Intermediate chunk count:** 67 chunks vs baseline's 92 and stability's 55 — hybrid provides a middle ground

### What Didn't Work

1. **Higher re-embed fraction:** Hybrid had 69.7% re-embed fraction, higher than both baseline (60.7%) and stability (63.3%)

2. **Fewer unchanged chunks:** Only 36 chunks persisted unchanged (vs 72 for baseline, 40 for stability)

3. **Small chunk sizes:** Mean chunk size dropped to 711 bytes due to micro-chunking, creating more total chunks than stability-driven alone

---

## Analysis

### Trade-off Dynamics

The hybrid policy creates an interesting trade-off structure:

1. **Localization Success:** By confining 80.7% of re-embeds to edit windows, hybrid successfully localizes the impact of changes. This is a significant improvement over the "all or nothing" behavior of pure stability chunking.

2. **Micro-chunk Proliferation:** However, micro-chunking within edit windows (52.2% of final chunks) creates many small overlapping chunks. Each edit window spawns multiple micro-chunks, increasing total chunk count.

3. **Content Hash Volatility:** The overlapping micro-chunks have high content hash volatility — small shifts in the edit window boundary cause all micro-chunks to be regenerated.

### Why Baseline Still Wins on Raw Metrics

Baseline's fixed-size overlap strategy has two hidden advantages:
1. **Predictable boundaries:** Even after edits, many chunks fall on similar byte boundaries
2. **Overlap absorption:** The 64-byte overlap absorbs small edits without changing chunk content

### Hybrid's True Value

Despite higher re-embed fractions, hybrid offers:
1. **Semantic coherence:** Base chunks outside edit windows maintain stability-driven coherence
2. **Predictable scaling:** Re-embed cost grows with edit window size, not document size
3. **Audit trail:** Parent chunk and edit window IDs provide change provenance

---

## Structural Observations

### Chunk Evolution

| Time Step | Baseline | Stability | Hybrid |
|-----------|----------|-----------|--------|
| t0 | 88 | 53 | 51 |
| t1 | 91 | 54 | 52 (32 micro) |
| t2 | 92 | 55 | 67 (35 micro) |

### Configuration Used

```toml
[chunking.hybrid]
enabled = true
micro_chunk_bytes = 768
micro_overlap_bytes = 96
guard_band_bytes = 256
```

---

## Artifacts Generated

### Experiment Runs
- `eval/results/v1.4.0-baseline-temporal-20260116/summary.json`
- `eval/results/v1.4.0-stability-temporal-20260116/summary.json`
- `eval/results/v1.4.0-hybrid-temporal-20260116/summary.json`

### Paper Artifacts
- `paper/tables/temporal_hybrid_v1.4.0-20260116.tex`
- `paper/figures/temporal_hybrid_v1.4.0-20260116.pdf`
- `paper/figures/temporal_localization_v1.4.0-20260116.pdf`

---

## Recommendations for Future Work

1. **Adaptive micro-chunk sizing:** Adjust micro-chunk size based on edit window size to reduce proliferation

2. **Lazy micro-chunking:** Only create micro-chunks on first query access, not eagerly on edit

3. **Micro-chunk consolidation:** After multiple edits, merge adjacent micro-chunks back into stability-driven chunks

4. **Content-aware guard bands:** Adjust guard band size based on detected content boundaries

---

## Release

Proceeding with v1.5.0 release. The hybrid chunking approach is a valid composition strategy, though current implementation shows room for optimization.
