# Claude Execution Output — v1.6.0 Cost-Weighted Mutation Metrics

**Timestamp:** 2026-01-16T21:15:00Z
**Input Prompt:** `AGENT/1768595902-in.md`
**Git Base:** v1.5.0

---

## v1.5.0 Takeaway (Mandatory Incorporation)

> **Takeaway (v1.5.0):** Hybrid chunking increased raw re-embed fraction because localized micro-chunking converts few large invalidations into many small ones. Raw chunk-count metrics therefore overstate mutation cost. Localization efficiency (80.7%) indicates that hybrid chunking confines change impact, motivating cost-weighted mutation metrics.

---

## Summary

Implemented cost-weighted mutation metrics to correctly interpret v1.5.0 hybrid chunking results. This is a measurement-only cycle with no changes to chunking, embedding, or FAISS logic.

---

## Key Results

### Count-Based vs Byte-Weighted Comparison

| Method | Count-Based Re-embed | Byte-Weighted Re-embed | Re-embed KB |
|--------|---------------------|------------------------|-------------|
| Baseline | 60.7% | 40.9% | 182.0 |
| Stability | 63.3% | 42.6% | 185.6 |
| **Hybrid** | 69.7% | **31.5%** | **82.9** |

### Ranking Reversal

| Ranking | Count-Based (v1.5.0) | Byte-Weighted (v1.6.0) |
|---------|---------------------|------------------------|
| Best | Baseline (60.7%) | **Hybrid (31.5%)** |
| Middle | Stability (63.3%) | Baseline (40.9%) |
| Worst | Hybrid (69.7%) | Stability (42.6%) |

---

## Hypothesis Evaluation

**Original Hypothesis:** When mutation cost is measured in bytes (or weighted mass) rather than chunk count, hybrid chunking will show lower effective mutation cost than fixed-size baseline, consistent with its high localization efficiency.

**Result:** **HYPOTHESIS CONFIRMED**

### Quantitative Support

1. **Byte-weighted cost reduction:** Hybrid achieves **54% lower** byte-weighted mutation cost than baseline (82.9 KB vs 182.0 KB)

2. **Ranking reversal:** Under count-based metrics, hybrid appeared worst (69.7%). Under byte-weighted metrics, hybrid is best (31.5%)

3. **Explanation:** Hybrid's micro-chunks are small (711 bytes mean) compared to baseline (1683 bytes) and stability (2742 bytes). Many small chunks being re-embedded costs less than fewer large chunks.

---

## Why This Matters

### The Measurement Distortion

Count-based metrics implicitly assume all chunks have equal cost:
```
reembed_fraction = added_chunks / total_chunks
```

This penalizes micro-chunking because:
- Hybrid: 83 added chunks × ~711 bytes = 59,013 bytes
- Baseline: 111 added chunks × ~1683 bytes = 186,813 bytes
- Stability: 69 added chunks × ~2742 bytes = 189,198 bytes

### The Correction

Byte-weighted metrics measure actual work:
```
reembed_fraction_bytes = sum(bytes per reembedded chunk) / total_bytes
```

This correctly captures that hybrid's many small re-embeds are cheaper than baseline's fewer large re-embeds.

---

## Localization Analysis

| Method | In-Window | Outside-Window | Localization Efficiency |
|--------|-----------|----------------|------------------------|
| Baseline | 68 | 43 | 61.3% |
| Stability | 65 | 4 | 94.2% |
| Hybrid | 67 | 16 | 80.7% |

Hybrid provides a middle ground: better localization than baseline while accepting more re-embeds than stability.

---

## Artifacts Generated

### Paper Artifacts
- `paper/tables/temporal_cost_weighted_v1.5.0.tex`
- `paper/figures/temporal_cost_weighted_v1.5.0.pdf`
- `paper/figures/cost_localization_curves_v1.5.0.pdf`

### Analysis Script
- `scripts/compute_cost_weighted_metrics.py` (PEP 723, deterministic)

---

## Recommendations

1. **Primary metric going forward:** Use byte-weighted re-embed fraction as the primary mutation cost metric

2. **Report both metrics:** Count-based metrics remain useful for index maintenance planning (number of embedding API calls), but byte-weighted captures actual semantic cost

3. **Hybrid validation:** The hybrid approach is now validated as the best-performing strategy when measured by actual update cost

---

## Release

Proceeding with v1.6.0 release. The cost-weighted metrics provide the correct interpretation of hybrid chunking's performance advantage.
